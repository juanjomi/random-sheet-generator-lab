<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Random Notes Sheets</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');

body {
  font-family: 'Inter', sans-serif;
  background-color: #f5f5f5;
  margin: 0;
  padding: 40px;
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
}

.card {
  background: white;
  border-radius: 12px;
  padding: 30px 40px;
  box-shadow: 0 4px 8px rgba(0,0,0,0.1);
  text-align: center;
  min-width: 320px;
}

h1 {
  margin: 0 0 24px;
  font-size: 22px;
}

.menu {
  display: flex;
  flex-direction: column;
  gap: 14px;
}

/* Seed row */
.seed-row {
  display: flex;
  gap: 8px;
}

.seed-row input {
  flex: 1;
}

input[type="text"] {
  padding: 12px 14px;
  font-size: 14px;
  border-radius: 8px;
  border: 1px solid #ccc;
  text-align: center;
}

.seed-row button {
  padding: 0 14px;
  font-size: 18px;
  border-radius: 8px;
  border: 1px solid #ccc;
  background: white;
  cursor: pointer;
}

button {
  padding: 14px 18px;
  font-size: 16px;
  border-radius: 8px;
  border: 1px solid #ccc;
  background: white;
  cursor: pointer;
}

button:hover {
  background-color: #e0e0e0;
}

.footer {
  margin-top: 24px;
  font-size: 12px;
  color: #777;
}
</style>
</head>

<body>

<div class="card">
  <h1>Choose Mode</h1>

  <div class="menu">

    <!-- Seed input -->
    <div class="seed-row">
      <input
        type="text"
        id="seedInput"
        placeholder="Optional seed (e.g. c:m-1a2b3c)"
      />
      <button id="seedConfirm" title="Go">✔︎</button>
    </div>

    <button onclick="goChromatic()">Chromatic Mode</button>
    <button onclick="go('scale-seed.html')">Scale Mode</button>
    <button onclick="sheetOfTheDay()">Sheet Of The Day</button>

  </div>

  <div class="footer">by Juan Naranjo / v2.0</div>
</div>

<script>
/* ========= RNG ========= */

function mulberry32(a) {
  return function() {
    let t = a += 0x6D2B79F5;
    t = Math.imul(t ^ t >>> 15, t | 1);
    t ^= t + Math.imul(t ^ t >>> 7, t | 61);
    return ((t ^ t >>> 14) >>> 0) / 4294967296;
  };
}

/* ========= SCALE CORE (for validation only) ========= */

const LETTERS = ["C","D","E","F","G","A","B"];
const NATURAL_PITCH = { C:0, D:2, E:4, F:5, G:7, A:9, B:11 };

const ACC_VAL = {
  "bb": -2,
  "b": -1,
  "n": 0,
  "♯": 1,
  "♯♯": 2
};

const SCALE_INTERVALS = {
  maj:[0,2,4,5,7,9,11],
  nat:[0,2,3,5,7,8,10],
  har:[0,2,3,5,7,8,11],
  mel:[0,2,3,5,7,9,11]
};

function buildScale(root, acc, type) {
  const start = LETTERS.indexOf(root);
  const letters = [];
  for (let i=0;i<7;i++) {
    letters.push(LETTERS[(start+i)%7]);
  }

  const rootPitch = NATURAL_PITCH[root] + ACC_VAL[acc];
  return letters.map((l,i)=>{
    const pitch = (rootPitch + SCALE_INTERVALS[type][i]) % 12;
    let diff = (pitch - NATURAL_PITCH[l] + 12) % 12;
    if (diff > 6) diff -= 12;
    const a = Object.keys(ACC_VAL).find(k=>ACC_VAL[k]===diff) || "n";
    return l + (a==="n" ? "" : a);
  });
}

/* ========= NAV ========= */

function go(page) {
  location.href = page;
}

function goChromatic() {
  const seed = seedInput.value.trim();
  if (seed) {
    location.href = `sheet.html?seed=${encodeURIComponent(seed)}`;
  } else {
    location.href = "chromatic-seed.html";
  }
}

/* ========= Sheet of the day ========= */

function sheetOfTheDay() {
  const d = new Date();
  const dateStr =
    d.getFullYear().toString().padStart(4,"0") +
    (d.getMonth()+1).toString().padStart(2,"0") +
    d.getDate().toString().padStart(2,"0");

  let hash = 0;
  for (let c of dateStr) {
    hash = (hash * 31 + c.charCodeAt(0)) >>> 0;
  }

  const hex = (hash & 0xffffff).toString(16).padStart(6,"0");
  const rng = mulberry32(hash);

  if (rng() < 0.5) {
    // chromatic
    const modes = ["s","b","m"];
    const mode = modes[Math.floor(rng()*modes.length)];
    location.href = `sheet.html?seed=c:${mode}-${hex}`;
    return;
  }

  // scale
  const roots = ["C","D","E","F","G","A","B"];
  const accs = ["n","b","♯"];
  const types = ["maj","nat","har","mel"];

  while (true) {
    const root = roots[Math.floor(rng()*roots.length)];
    const acc  = accs[Math.floor(rng()*accs.length)];
    const type = types[Math.floor(rng()*types.length)];

    const notes = buildScale(root, acc, type);
    const invalid = notes.some(n => n.includes("bb") || n.includes("♯♯"));
    if (invalid) continue;

    location.href = `sheet.html?seed=s:${root}${acc}:${type}-${hex}`;
    return;
  }
}

/* ========= Events ========= */

seedConfirm.onclick = goChromatic;
seedInput.addEventListener("keydown", e => {
  if (e.key === "Enter") goChromatic();
});
</script>

</body>
</html>
